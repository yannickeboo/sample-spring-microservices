pipeline {

 
  agent any
   
    environment{
        VERSION = "${env.BUILD_ID}"
        IMAGE_NAME = "yannickeboo/anael"
    }
    stages {
          
        stage('Build') { 
          
            steps {
                
                sh 'mvn clean package' 
            }
            
        }
     stage('docker image') {
      
     agent {
    kubernetes {
      //cloud 'kubernetes'
      defaultContainer 'kaniko'
      yaml """
kind: Pod
spec:
  serviceAccountName: jenkins-sa
  containers:
  - name: kaniko
    image: gcr.io/kaniko-project/executor:debug-539ddefcae3fd6b411a95982a830d987f4214251
    imagePullPolicy: Always
    command:
    - sleep
    args:
    - 9999999
"""
    }
  }

      steps {
       
       dir('customer-service'){
      sh '/kaniko/executor -f `pwd`/Dockerfile -c `pwd` --cache=true --destination=yannickeboo/kanino:v1'
        
       }
       }
       
        
     
         
      }
     }
    }
}
